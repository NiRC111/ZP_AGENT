<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Government Quasi-Judicial AI System ‚Äî Zilla Parishad Chandrapur</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>

<!-- PDF.js & Mammoth (client text extraction) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.js" crossorigin="anonymous"></script>
<script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>
<!-- Tesseract.js OCR (eng+hin+mar) -->
<script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--saffron:#FF9933;--green:#138808;--ink:#222;--muted:#666;--panel:#fff;--soft:#f8f9fa}
body{font-family:'Roboto','Noto Sans Devanagari',sans-serif;background:linear-gradient(135deg,#FF9933 0%,#FFFFFF 50%,#138808 100%);min-height:100vh;color:var(--ink)}
.gov-header{background:#fff;border-bottom:3px solid var(--saffron);padding:14px 0;box-shadow:0 2px 10px rgba(0,0,0,.08)}
.gov-header-content{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:0 20px}
.gov-logo-section{display:flex;align-items:center;gap:22px}
.emblem{width:84px;height:84px;background:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTAiIGhlaWdodD0iOTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNDUiIGN5PSI0NSIgcj0iNDIiIGZpbGw9IiNGRkI5RDAiIHN0cm9rZT0iI0ZGOEMwMCIgc3Ryb2tlLXdpZHRoPSIzIi8+PHRleHQgeD0iNDUiIHk9IjUxIiBmb250LXNpemU9IjEwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOEI0NTEzIj7gpq7gp4fgp4Tgpr7gprAg4KSf4KSH4KSV4KS-4KWN4KSfPC90ZXh0Pjwvc3ZnPg==') center/contain no-repeat}
.maha-seal{width:84px;height:84px;background:radial-gradient(circle,#FFD700 0%,#FFA500 70%);border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #FF8C00}
.gov-titles{display:flex;flex-direction:column}
.gov-title-marathi{font-family:'Noto Sans Devanagari',sans-serif;font-size:22px;font-weight:800;color:var(--saffron)}
.gov-title-english{font-size:18px;font-weight:800;color:#333;letter-spacing:.4px}
.gov-subtitle{font-size:13px;color:var(--muted);margin-top:4px}
.security-info{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
.security-badge{background:var(--green);color:#fff;padding:6px 14px;border-radius:20px;font-size:12px}
.session-info{font-size:12px;color:var(--muted)}
.language-toggle{position:fixed;top:112px;right:20px;background:#fff;border-radius:25px;box-shadow:0 4px 15px rgba(0,0,0,.2);display:flex;overflow:hidden;z-index:1000}
.lang-btn{padding:10px 20px;border:none;background:#fff;font-weight:800;cursor:pointer}
.lang-btn.active{background:var(--saffron);color:#fff}
.main-container{max-width:1400px;margin:18px auto;padding:0 20px}
.alert-banner{background:#FFF3CD;border:2px solid #FFC107;border-radius:10px;padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.alert-text{font-weight:700;color:#856404}
.tabs-nav{background:#fff;border-radius:10px;padding:10px;margin-bottom:18px;display:flex;gap:10px;box-shadow:0 2px 10px rgba(0,0,0,.08);flex-wrap:wrap}
.tab-btn{padding:12px 20px;border:none;background:#f0f0f0;border-radius:8px;font-weight:800;cursor:pointer}
.tab-btn.active{background:linear-gradient(135deg,#FF9933,#FF6B00);color:#fff}
.tab-content{display:none}
.tab-content.active{display:block}
.panel{background:var(--panel);border-radius:14px;padding:22px;margin-bottom:18px;box-shadow:0 4px 18px rgba(0,0,0,.08)}
.panel-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:14px;border-bottom:3px solid var(--saffron);margin-bottom:16px}
.panel-title{font-size:19px;font-weight:900;color:#333;display:flex;gap:10px}
.required-mark{color:#e74c3c;font-size:18px}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-bottom:16px}
.form-group{display:flex;flex-direction:column}
.form-label{font-weight:800;color:#444;margin-bottom:8px;display:flex;gap:6px}
.form-control{padding:11px;border:2px solid #ddd;border-radius:8px;font-size:15px}
.form-control:focus{outline:none;border-color:var(--saffron)}
.upload-zone{border:3px dashed #3498db;border-radius:14px;padding:22px;text-align:center;background:#f8f9fa;cursor:pointer;transition:.2s;margin-bottom:10px}
.upload-zone:hover{background:#e3f2fd;border-color:#2196f3}
.upload-zone.has-file{background:#e8f5e9;border-color:#4caf50;border-style:solid}
.file-list{margin-top:10px;text-align:left}
.file-item{background:#fff;padding:10px;border-radius:8px;margin-top:8px;display:flex;justify-content:space-between;align-items:center;border:1px solid #eee}
.case-type-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.case-type-card{background:#f8f9fa;border:2px solid transparent;border-radius:10px;padding:12px;cursor:pointer;display:flex;gap:10px;align-items:center}
.case-type-card:hover{background:#e3f2fd;border-color:#2196f3}
.case-type-card.selected{background:#fff3e0;border-color:var(--saffron)}
.action-panel{background:#fff;border-radius:14px;padding:22px;box-shadow:0 4px 18px rgba(0,0,0,.08);display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn{padding:13px 22px;border:none;border-radius:10px;font-size:15px;font-weight:900;cursor:pointer;color:#fff}
.btn-analyze{background:linear-gradient(135deg,#667eea,#764ba2)}
.btn-decision{background:linear-gradient(135deg,#f093fb,#f5576c)}
.btn-order{background:linear-gradient(135deg,#4facfe,#00f2fe)}
.btn-print{background:linear-gradient(135deg,#43e97b,#38f9d7)}
.status-message{padding:12px;border-radius:10px;margin:12px 0;display:none}
.status-message.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;display:block}
.status-message.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;display:block}
.status-message.warning{background:#fff3cd;color:#856404;border:1px solid #ffeeba;display:block}
.output-panel{background:#fff;border-radius:14px;padding:22px;margin-top:16px;box-shadow:0 4px 18px rgba(0,0,0,.08);display:none}
.output-panel.active{display:block}
.output-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:14px;border-bottom:3px solid var(--saffron);margin-bottom:14px}
.output-title{font-size:20px;font-weight:900;color:#333}
.output-content{font-size:16px;line-height:1.85;white-space:pre-wrap;color:#111}
.signature-block{margin-top:28px;padding-top:14px;border-top:2px solid #ddd}
.signature-grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-top:32px}
.signature-item{text-align:center}
.signature-line{border-bottom:2px solid #333;margin-bottom:10px;height:40px}
.loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center;z-index:9999}
.loading-overlay.active{display:flex}
.loading-box{background:#fff;padding:30px;border-radius:14px;text-align:center}
.spinner{border:4px solid #f3f3f3;border-top:4px solid var(--saffron);border-radius:50%;width:54px;height:54px;animation:spin 1s linear infinite;margin:0 auto 14px}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
@media (max-width:768px){.gov-header-content{flex-direction:column;text-align:center}.security-info{align-items:center;margin-top:8px}.signature-grid{grid-template-columns:1fr}}
</style>
</head>

<body>
<header class="gov-header">
  <div class="gov-header-content">
    <div class="gov-logo-section">
      <div class="emblem" title="‡§∏‡§§‡•ç‡§Ø‡§Æ‡•á‡§µ ‡§ú‡§Ø‡§§‡•á"></div>
      <div class="gov-titles">
        <div class="gov-title-marathi">‡§ú‡§ø‡§≤‡•ç‡§π‡§æ ‡§™‡§∞‡§ø‡§∑‡§¶ ‡§ö‡§Ç‡§¶‡•ç‡§∞‡§™‡•Ç‡§∞</div>
        <div class="gov-title-english">ZILLA PARISHAD CHANDRAPUR</div>
        <div class="gov-subtitle">Office of the Chief Executive Officer | ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø</div>
      </div>
      <div class="maha-seal" title="‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§∂‡§æ‡§∏‡§®"><span style="font-size:12px;font-weight:800;color:#8B4513;line-height:1.1;text-align:center">‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞<br/>‡§∂‡§æ‡§∏‡§®</span></div>
    </div>
    <div class="security-info">
      <div class="security-badge">üîí Secure Government Portal</div>
      <div class="session-info" id="sessionInfo"></div>
    </div>
  </div>
</header>

<div class="language-toggle">
  <button class="lang-btn active" onclick="setLanguage('mr',event)">‡§Æ‡§∞‡§æ‡§†‡•Ä</button>
  <button class="lang-btn" onclick="setLanguage('en',event)">English</button>
</div>

<div class="main-container">
  <div class="alert-banner">
    <span class="alert-text">
      <span class="t-en" style="display:none">This system handles sensitive government decisions. All actions are logged and audited.</span>
      <span class="t-mr">‡§π‡•Ä ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§π‡§æ‡§§‡§æ‡§≥‡§§‡•á. ‡§∏‡§∞‡•ç‡§µ ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§ø‡§≤‡•ç‡§Ø‡§æ ‡§µ ‡§ë‡§°‡§ø‡§ü ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ‡§§.</span>
    </span>
  </div>

  <div class="tabs-nav">
    <button class="tab-btn active" onclick="showTab('upload',event)">üìÅ <span class="t-en" style="display:none">Documents</span><span class="t-mr">‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á</span></button>
    <button class="tab-btn" onclick="showTab('case',event)">‚öñÔ∏è <span class="t-en" style="display:none">Case Details</span><span class="t-mr">‡§™‡•ç‡§∞‡§ï‡§∞‡§£ ‡§§‡§™‡§∂‡•Ä‡§≤</span></button>
    <button class="tab-btn" onclick="showTab('analysis',event)">üìä <span class="t-en" style="display:none">AI Analysis</span><span class="t-mr">AI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</span></button>
  </div>

  <!-- Upload -->
  <div id="upload-tab" class="tab-content active">
    <div class="panel">
      <div class="panel-header"><h2 class="panel-title">üìÅ <span class="t-en" style="display:none">Document Upload Section</span><span class="t-mr">‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§µ‡§ø‡§≠‡§æ‡§ó</span></h2></div>

      <div class="form-group">
        <label class="form-label"> <span class="t-en" style="display:none">Case File</span><span class="t-mr">‡§™‡•ç‡§∞‡§ï‡§∞‡§£ ‡§´‡§æ‡§à‡§≤</span> <span class="required-mark">*</span></label>
        <div class="upload-zone" id="caseUploadZone" onclick="document.getElementById('caseFile').click()">
          <b>PDF, DOCX, Image</b>
          <input type="file" id="caseFile" accept=".pdf,.docx,image/*" style="display:none" onchange="handleFileUpload('case',this)">
          <div id="caseFileList" class="file-list"></div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label"> <span class="t-en" style="display:none">Government Resolution (GR)</span><span class="t-mr">‡§∂‡§æ‡§∏‡§® ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø (GR)</span> <span class="required-mark">*</span></label>
        <div class="upload-zone" id="grUploadZone" onclick="document.getElementById('grFile').click()">
          <b>PDF, DOCX, Image</b>
          <input type="file" id="grFile" accept=".pdf,.docx,image/*" style="display:none" onchange="handleFileUpload('gr',this)">
          <div id="grFileList" class="file-list"></div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label"><span class="t-en" style="display:none">Additional Legal Docs (Optional)</span><span class="t-mr">‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ï‡§æ‡§Ø‡§¶‡•á‡§∂‡•Ä‡§∞ ‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á (‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡•Ä)</span></label>
        <div class="upload-zone" id="legalUploadZone" onclick="document.getElementById('legalFiles').click()">
          <b>Judgments/Sections/Procedures</b>
          <input type="file" id="legalFiles" accept=".pdf,.docx,image/*" multiple style="display:none" onchange="handleFileUpload('legal',this)">
          <div id="legalFileList" class="file-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Case -->
  <div id="case-tab" class="tab-content">
    <div class="panel">
      <div class="panel-header"><h2 class="panel-title">‚öñÔ∏è <span class="t-en" style="display:none">Case Configuration</span><span class="t-mr">‡§™‡•ç‡§∞‡§ï‡§∞‡§£ ‡§ï‡•â‡§®‡•ç‡§´‡§ø‡§ó‡§∞‡•á‡§∂‡§®</span></h2></div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label"><span class="t-en" style="display:none">Case Number</span><span class="t-mr">‡§´‡§æ‡§à‡§≤ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</span></label>
          <input id="caseNumber" class="form-control" placeholder="‡§ú‡§ø‡§™/‡§Æ‡•Å‡§ï‡§æ‡§Ö/‡•®‡•¶‡•®‡•´/XXX">
        </div>
        <div class="form-group">
          <label class="form-label"><span class="t-en" style="display:none">Applicant Name</span><span class="t-mr">‡§Ö‡§∞‡•ç‡§ú‡§¶‡§æ‡§∞ ‡§®‡§æ‡§µ</span></label>
          <input id="applicantName" class="form-control" placeholder="‡§â‡§¶‡§æ. ‡§∏‡•å. ‡§á‡§Ç‡§¶‡•Å‡§¨‡§æ‡§à ‡§∞‡§æ‡§†‡•ã‡§°">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label"><span class="t-en" style="display:none">Specific Legal Sections/Rules</span><span class="t-mr">‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ï‡§æ‡§Ø‡§¶‡•á‡§∂‡•Ä‡§∞ ‡§ï‡§≤‡§Æ‡•á/‡§®‡§ø‡§Ø‡§Æ</span></label>
        <textarea id="legalSections" class="form-control" rows="3" placeholder="‡§â‡§¶‡§æ. GR ‡§¶‡§ø. 02/02/2023; MCS Rules; RTI S.19"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label"><span class="t-en" style="display:none">Brief Case Description</span><span class="t-mr">‡§™‡•ç‡§∞‡§ï‡§∞‡§£‡§æ‡§ö‡•á ‡§•‡•ã‡§°‡§ï‡•ç‡§Ø‡§æ‡§§ ‡§µ‡§∞‡•ç‡§£‡§®</span></label>
        <textarea id="caseDescription" class="form-control" rows="5" placeholder="‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•á ‡§•‡•ã‡§°‡§ï‡•ç‡§Ø‡§æ‡§§..."></textarea>
      </div>
    </div>
  </div>

  <!-- Analysis -->
  <div id="analysis-tab" class="tab-content">
    <div class="panel">
      <div class="panel-header"><h2 class="panel-title">üìä <span class="t-en" style="display:none">AI Analysis</span><span class="t-mr">AI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</span></h2></div>
      <div id="analysisBox" class="output-content" style="background:#f8f9fa;border:1px solid #eee;border-radius:10px;padding:16px;min-height:140px"><em>‡§ï‡§æ‡§ó‡§¶‡§™‡§§‡•ç‡§∞‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ ‡§µ ‚ÄúAnalyze with AI‚Äù ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ.</em></div>
    </div>
  </div>

  <div class="action-panel">
    <button class="btn btn-analyze" onclick="analyzeCase()">üîç <span class="t-en" style="display:none">ANALYZE WITH AI</span><span class="t-mr">AI ‡§∏‡§π ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</span></button>
    <button class="btn btn-decision" onclick="generateDecision()">üìù <span class="t-en" style="display:none">GENERATE DECISION</span><span class="t-mr">‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ</span></button>
    <button class="btn btn-order" onclick="generateOrder()">üìã <span class="t-en" style="display:none">GENERATE ORDER</span><span class="t-mr">‡§Ü‡§¶‡•á‡§∂ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ</span></button>
    <button class="btn btn-print" onclick="printOutput()">üñ®Ô∏è PDF</button>
  </div>

  <div id="statusMessage" class="status-message"></div>

  <div id="outputPanel" class="output-panel">
    <div class="output-header">
      <h2 class="output-title" id="outputTitle">Output</h2>
      <div>
        <button class="btn btn-analyze" style="padding:8px 14px" onclick="copyOutput()">üìã Copy</button>
        <button class="btn btn-order" style="padding:8px 14px" onclick="downloadOutput()">üíæ Download</button>
      </div>
    </div>
    <div id="outputContent" class="output-content"></div>
    <div id="signatureBlock" class="signature-block"></div>
  </div>
</div>

<div id="loadingOverlay" class="loading-overlay">
  <div class="loading-box">
    <div class="spinner"></div>
    <h3 style="color:#333;margin-bottom:8px">Processing‚Ä¶</h3>
    <p style="color:#666">Reading documents and extracting facts</p>
  </div>
</div>

<script>
document.getElementById('sessionInfo').textContent="Session: "+new Date().toLocaleString();

let lang='mr';
let uploaded={case:null,gr:null,legal:[]};
let textStore={caseText:'',grText:'',legalText:''};
let facts={};

function setLanguage(l,ev){lang=l;document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));ev.target.classList.add('active');document.querySelectorAll('.t-en').forEach(x=>x.style.display=(l==='en')?'inline':'none');document.querySelectorAll('.t-mr').forEach(x=>x.style.display=(l==='mr')?'inline':'none');}
function showTab(name,ev){document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.getElementById(name+'-tab').classList.add('active');ev.target.classList.add('active');}
function showStatus(msg,type){const el=document.getElementById('statusMessage');el.textContent=msg;el.className='status-message '+type;setTimeout(()=>{el.className='status-message'},5000)}
function loading(b){document.getElementById('loadingOverlay').classList.toggle('active',b);}

async function handleFileUpload(kind,input){
  const files=input.files; if(!files||!files.length) return;
  for(const f of files){ if(f.size>15*1024*1024){ showStatus('Max 15MB per file', 'error'); return; } }
  if(kind==='case'){ uploaded.case=files[0]; document.getElementById('caseUploadZone').classList.add('has-file'); document.getElementById('caseFileList').innerHTML=`<div class="file-item"><span>‚úÖ ${files[0].name}</span><span>${(files[0].size/1024).toFixed(0)} KB</span></div>`; textStore.caseText = await readFileToText(files[0]); }
  if(kind==='gr'){ uploaded.gr=files[0]; document.getElementById('grUploadZone').classList.add('has-file'); document.getElementById('grFileList').innerHTML=`<div class="file-item"><span>‚úÖ ${files[0].name}</span><span>${(files[0].size/1024).toFixed(0)} KB</span></div>`; textStore.grText = await readFileToText(files[0]); }
  if(kind==='legal'){ uploaded.legal=Array.from(files); document.getElementById('legalUploadZone').classList.add('has-file'); document.getElementById('legalFileList').innerHTML = uploaded.legal.map(f=>`<div class="file-item"><span>‚úÖ ${f.name}</span><span>${(f.size/1024).toFixed(0)} KB</span></div>`).join(''); const chunks = await Promise.all(uploaded.legal.map(readFileToText)); textStore.legalText = chunks.join('\n\n'); }
  showStatus(kind.toUpperCase()+' uploaded','success');
}

async function readFileToText(file){
  const ext=file.name.toLowerCase().split('.').pop();
  try{
    if(ext==='pdf'){ const buf=await file.arrayBuffer(); const pdf=await pdfjsLib.getDocument({data:buf}).promise; let out=''; for(let i=1;i<=pdf.numPages;i++){ const page=await pdf.getPage(i); const txt=await page.getTextContent(); out += txt.items.map(it=>it.str).join(' ') + '\n'; } return out.trim(); }
    if(ext==='docx'){ const ab=await file.arrayBuffer(); const res=await window.mammoth.extractRawText({arrayBuffer:ab}); return (res.value||'').trim(); }
    if(['png','jpg','jpeg','webp','tif','tiff','bmp'].includes(ext)){ loading(true); try{ const worker=await Tesseract.createWorker(); await worker.loadLanguage('eng+hin+mar'); await worker.initialize('eng+hin+mar'); const {data:{text}}=await worker.recognize(file); await worker.terminate(); return text.trim(); } finally { loading(false); } }
    return await file.text();
  }catch(e){ console.error(e); showStatus('Could not read file. You may paste text under Case Details.', 'warning'); return ''; }
}

function basicParseFacts(txt){
  const d={complainant:'',village:'',taluka:'',hearingDate:'',hearingTime:'',refs:[]};
  let m = /(‡§∏‡•å\.|‡§∂‡•ç‡§∞‡•Ä\.?)\s*([‡§Ö-‡§π][^\s,]*)\s+([‡§Ö-‡§π][^,]*)[, ]+\s*‡§∞‡§æ\.?\s*([‡§Ö-‡§π][^,]*)(?:,\s*‡§§‡§æ\.?\s*([‡§Ö-‡§π][^,]*))?/u.exec(txt);
  if(m){ d.complainant=`${m[2]} ${m[3]}`.trim(); d.village=(m[4]||'').trim(); d.taluka=(m[5]||'').trim(); }
  m = /(‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä).{0,10}(‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï|‡§¶‡§ø\.?)\s*[:\-]?\s*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})/u.exec(txt);
  if(m){ d.hearingDate=m[3]; }
  m = /(‡§∏‡§ï‡§æ‡§≥‡•Ä|‡§∏‡§æ‡§Ø‡§Ç‡§ï‡§æ‡§≥‡•Ä)\s*([‡•¶-‡•Ø0-9]{1,2})\s*(‡§µ‡§æ|‡§µ‡§æ‡§ú‡§§‡§æ)/u.exec(txt);
  if(m){ d.hearingTime = `${m[2]} ‡§µ‡§æ‡§ú‡§§‡§æ`; }
  d.refs = txt.split(/\n+/).filter(ln=>/(‡§∂‡§æ‡§∏‡§® ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø|‡§™‡§§‡•ç‡§∞|‡§§‡§ï‡•ç‡§∞‡§æ‡§∞|‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä|‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï|‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï)/u.test(ln)).slice(0,6);
  return d;
}

function ensureMandatory(){
  if(!uploaded.case){ showStatus('Case file required','error'); showTab('upload',event); return false; }
  if(!uploaded.gr){ showStatus('GR file required','error'); showTab('upload',event); return false; }
  return true;
}

async function analyzeCase(){
  if(!ensureMandatory()) return;
  facts = basicParseFacts(textStore.caseText || '');
  const analysis =
`FACTS (auto-detected)
‚Ä¢ ‡§Ö‡§∞‡•ç‡§ú‡§¶‡§æ‡§∞: ${facts.complainant||'‚Äî'}
‚Ä¢ ‡§ó‡§æ‡§µ/‡§§‡§æ‡§≤‡•Å‡§ï‡§æ: ${facts.village||'‚Äî'} / ${facts.taluka||'‚Äî'}
‚Ä¢ ‡§∏‡•Å‡§®‡§æ‡§µ‡§£‡•Ä: ${facts.hearingDate||'‚Äî'} ${facts.hearingTime?`(${facts.hearingTime})`:''}

REFERENCES (case text)
${(facts.refs||[]).map((r,i)=>`  ${i+1}. ${r}`).join('\n')||'  ‚Äî'}

LLM will use uploaded GR + case text while drafting decision/order.`;
  document.getElementById('analysisBox').textContent=analysis;
  showStatus('Analysis ready','success');
  showTab('analysis',event);
}

async function callLLM(mode){
  loading(true);
  try{
    const payload={
      lang,
      mode, // 'decision' | 'order'
      caseNumber: document.getElementById('caseNumber').value || '',
      applicantName: document.getElementById('applicantName').value || '',
      caseDescription: document.getElementById('caseDescription').value || '',
      legalSections: document.getElementById('legalSections').value || '',
      facts,
      texts:{
        caseText: (textStore.caseText||'').slice(0,16000),
        grText: (textStore.grText||'').slice(0,16000),
        legalText: (textStore.legalText||'').slice(0,8000)
      }
    };
    const res = await fetch('/api/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    const data = await res.json();
    if(!res.ok){ throw new Error(data.error||'LLM error'); }
    displayOutput(data.title, data.content, true);
    showStatus('Generated successfully','success');
  }catch(e){
    console.error(e);
    showStatus('Server error: '+e.message,'error');
  }finally{ loading(false); }
}

function generateDecision(){ if(!ensureMandatory()) return; callLLM('decision'); }
function generateOrder(){ if(!ensureMandatory()) return; callLLM('order'); }

function displayOutput(title,content,withSig){
  document.getElementById('outputTitle').textContent=title;
  document.getElementById('outputContent').textContent=content;
  document.getElementById('signatureBlock').innerHTML = withSig ? `
    <div class="signature-grid">
      <div class="signature-item"><div class="signature-line"></div><div><b>${lang==='mr'?'‡§Æ‡§∏‡•Å‡§¶‡§æ':'Prepared By'}</b><br>${lang==='mr'?'‡§∏‡§π‡§æ‡§Ø‡•ç‡§Ø‡§ï CEO':'Assistant CEO'}</div></div>
      <div class="signature-item"><div class="signature-line"></div><div><b>${lang==='mr'?'‡§Æ‡§æ‡§®‡•ç‡§Ø':'Approved By'}</b><br>${lang==='mr'?'‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§æ‡§∞‡•Ä ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä':'Chief Executive Officer'}</div></div>
    </div>` : '';
  document.getElementById('outputPanel').classList.add('active');
  document.getElementById('outputPanel').scrollIntoView({behavior:'smooth'});
}

function copyOutput(){ const t=document.getElementById('outputContent').textContent; navigator.clipboard.writeText(t); showStatus('Copied','success'); }
function downloadOutput(){ const t=document.getElementById('outputContent').textContent; const blob=new Blob([t],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='Order_'+Date.now()+'.txt'; a.click(); URL.revokeObjectURL(url); showStatus('Downloaded','success'); }

document.addEventListener('DOMContentLoaded',()=>{ showStatus('System ready ‚Äî upload Case + GR','success'); });
</script>
</body>
</html>
